# aws-lambda-decorators
A set of Python decorators to ease the development of AWS lambda functions.

## Installation

The easiest way to use these AWS Lambda Decorators is to install them through Pip:

`pip install -i https://test.pypi.org/simple/ aws-lambda-decorators`

## Decorators

The current list of AWS Lambda Python Decorators includes:

* __extract__: a decorator to extract and validate a list of variables from any dictionary parameter (selected by index) passed to any type of AWS lambda function.
* __extract_from_event__: a facade of _extract_ to extract and validate a list of variables in an AWS API Gateway lambda function _event_.
* __extract_from_context__: a facade of _extract_ to extract and validate a list of variables in an AWS API Gateway lambda function _context_.
* __extract_from_ssm__: a decorator to extract the values of a set of keys from AWS SSM.
* __log__: a decorator to log the parameters passed to the lambda function and/or the response of the lambda function.
* __handle_exceptions__: a decorator to handle any type of declared exception generated by the lambda function. 
* __response_body_as_json__: a decorator to transform the body of a response to json.

## Examples

### Decorators

#### extract

This decorator extracts a list of variables from a dictionary parameter passed to a Lambda Function.

* The decorator takes a list of Parameter objects.
* Each Parameter object requires a non-empty path to the parameter in the dictionary.
* The parameter value is then extracted and added as a kwarg to the lambda handler.
* The name of the extracted parameter is defaulted to the last element of the path name, but can be changed by passing a (valid pythonic variable name) value to var_name
* You can define a default value for the parameter in the lambda handler itself.
* The dictionary is defaulted to be the first parameter of the lambda function, but can be changed by passing a func_param_index
* A 400 exception is raised when the parameter cannot be extracted or when it does not validate.
* A variable path (e.g. '/headers/Authorization[jwt]/sub') can be annotated to specify a decoding. In the example, Authorization might contain a JWT, which needs to be decoded before accessing the "sub" element.

```python
@extract(parameters=[
    Parameter(path='/parent/my_param'),  # extracts a non mandatory my_param from dictionary
    Parameter(path='/parent/child/id', validators=[Mandatory], var_name='user_id', func_param_index=1)  # extracts a mandatory id as "user_id" from another_dictionary
])
def lambda_handler(dictionary, another_dictionary, my_param='aDefaultValue', user_id=None):
    pass
```

#### extract_from_event

This decorator is just a facade to the extract method to be used in AWS Api Gateway Lambdas. It automatically extracts from the event lambda parameter.

```python
@extract_from_event(parameters=[
    Parameter(path='/body[json]/my_param', validators=[Mandatory),  # extracts a mandatory my_param from the json body of the event
    Parameter(path='/headers/Authorization[jwt]/sub', validators=[Mandatory], var_name='user_id')  # extract the mandatory sub value as user_id from the authorization JWT
])
def api_gateway_lambda_handler(event, context, my_param=None, user_id=None):
    pass
```

#### extract_from_context

This decorator is just a facade to the extract method to be used in AWS Api Gateway Lambdas. It automatically extracts from the context lambda parameter.

```python
@extract_from_event(parameters=[
    Parameter(path='/parent/my_param', validators=[Mandatory]),  # extracts a mandatory my_param from the parent element in context
])
def api_gateway_lambda_handler(event, context, my_param=None):
    pass
```

#### extract_from_ssm

This decorator extract a parameter from AWS SSM and passes the parameter down to your function as a kwarg.

* The decorator takes a list of SSMParameter objects.
* Each SSMParameter object requires the name of the SSM parameter (ssm_name)
* If no var_name is passed in, the extracted value is passed to the function with the ssm_name name

```python
@extract_from_ssm([
    SSMParameter(ssm_name='one_key'),  # extracts the value of one_key from SSM as a kwargs named "one_key"
    SSMParameter(ssm_name='another_key', var_name="another"),  # extracts 
])
def your_function(your_func_params, one_key=None, another=None):
    pass
```

#### log

This decorator allows for logging the function arguments and/or the lambda response.

```python
@log(parameters=True, response=True)
def lambda_handler(parameters): 
    pass
```

#### handle_exceptions

This decorator handles a list of exceptions, returning a 400 response containing the specified friendly message to the caller.

```python
@handle_exceptions(handlers=[
    ExceptionHandler(ClientError, "Your message when a client error happens.")
])
def lambda_handler(parameters):
    pass
```

#### response_body_as_json

This decorator ensures that, if the response contains a body, the body is dumped as json.

```python
@response_body_as_json
def lambda_handler(parameters):
    pass
```

### Validators

These classes are used to validate a lambda parameter:

* __Mandatory__
* __RegexValidator__

### Classes

### Decoders

### Utils

### Contributing

If you want to contribute to this project, clone the Github repo and install the requirements:

`pip install -r requirements.txt`

Before submitting the PR, please ensure that:
 
- you run prospector for code analysis, and all checks are passing:

`prospector`

- all unit tests are passing:

`coverage run --branch --source='.' -m unittest`

- you have 100% unit test coverage:

`coverage report -m --fail-under=100 --omit=*/__init__.py,tests/*,setup.py`

## Links

* [PyPi](https://test.pypi.org/project/aws-lambda-decorators/)
* [Github](https://github.com/gridsmartercities/aws-lambda-decorators)

